# Unsupervised Hierarchical Iterative Tile Refinement Network with 3D Planar Segmentation Loss

The code for "Unsupervised Hierarchical Iterative Tile Refinement Network with 3D Planar Segmentation Loss"

# Citation

# Settings

The code is tested with Pytorch 1.13, CUDA 11, Python 3.10 and Ubuntu 22.04 using a single GPU. The requirements.txt is provided.

```sh
pip install -r requirements
```

# Train

A train.sh file is provided for KITTI dataset. The `DATAPATH` in train.sh needs to be replaced to your path of KITTI dataset.
```sh
DATAPATH=YOUR_DATAPATH
LOGDIR=./logs
CUDA_VISIBLE_DEVICES=0 python main.py --dataset kitti \
    --datapath $DATAPATH --trainlist filenames/kt2015_train_first20.txt --testlist filenames/kt2015_val_first20.txt \
    --logdir $LOGDIR \
    --ckpt_start_epoch 200 --summary_freq 100 \
    --epochs 8000 \
    --batch_size 4 --test_batch_size 8 \
    --lr 0.0001 \
    --maxdisp 192
```

The corresponding edge images to KITTI images are needed. They could be generated by classical algorithms such as Canny, or deep learning methods such as [RCF](https://github.com/yun-liu/RCF-PyTorch) (employed in our experiments).

# Test

Pre-trained model for KITTI 2015 is available at [Google Drive](https://drive.google.com/file/d/1A5naJwn9h31ogr9Oq_V1QxkF3u2cIoKu/view?usp=share_link).

A test.sh file is provided for KITTI dataset. The 'DATAPATH' needs to be replaced to your path of KITTI dataset and the 'MODEL' needs to be set as the path of trained model.
```sh
DATAPATH=YOUR_DATAPATH
LOGDIR=./logs/test
MODEL=logs/trained_model/kitti.ckpt
CUDA_VISIBLE_DEVICES=0 python test.py --dataset kitti \
    --datapath $DATAPATH --testlist filenames/kt2015_val_first20.txt \
    --logdir $LOGDIR \
    --resume  $MODEL\
    --summary_freq 20 \
    --test_batch_size 8 \
    # --save_disp_to_file
```

# Acknowledgment

We would like to express our gratitude to the following papers and repositories.

[1] [HITNet](https://github.com/google-research/google-research/tree/master/hitnet): [Hierarchical Iterative Tile Refinement Network for Real-time Stereo Matching.](https://arxiv.org/abs/2007.12140)

[2] [The PyTorch implementation of HITNet.](https://github.com/MJITG/PyTorch-HITNet-Hierarchical-Iterative-Tile-Refinement-Network-for-Real-time-Stereo-Matching)

[3] [Monodepth2](https://github.com/nianticlabs/monodepth2): [Digging into Self-Supervised Monocular Depth Prediction.](https://arxiv.org/abs/1806.01260)

[4] [RCF: Richer Convolutional Features for Edge Detection](https://github.com/yun-liu/RCF-PyTorch)
